---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Navbar from '../../components/sections/Navbar.astro';
import Footer from '../../components/sections/Footer.astro';
import { PRODUCTS } from '../../data/products'; 
import { ArrowUpRight } from 'lucide-react';
---

<BaseLayout 
  title="Catálogo de Productos | Consultec" 
  description="Explora nuestra suite completa de sistemas Aguarai y equipamiento de hardware industrial."
>
  <Navbar />
  
  <main class="pt-32 pb-24 bg-space-950 min-h-screen">
    
    <div class="max-w-7xl mx-auto px-6 mb-16 text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-text-main mb-6">
        Catálogo Tecnológico
      </h1>
      <p class="text-xl text-text-muted max-w-2xl mx-auto">
        Software desarrollado en Itapúa y hardware de marcas líderes. <br/>
        Encuentra la solución exacta para tu industria.
      </p>
    </div>

    <div class="max-w-7xl mx-auto px-6 mb-12">
      <div class="flex flex-wrap justify-center gap-4" id="filters">
        <button class="filter-btn active px-6 py-2 rounded-full border border-space-800 bg-neon-cyan text-space-950 font-bold transition-all" data-filter="all">
            Todos
        </button>
        <button class="filter-btn px-6 py-2 rounded-full border border-space-800 bg-space-900 text-text-muted hover:text-white hover:border-neon-cyan/50 transition-all font-medium" data-filter="software">
            Sistemas Aguarai
        </button>
        <button class="filter-btn px-6 py-2 rounded-full border border-space-800 bg-space-900 text-text-muted hover:text-white hover:border-tech-blue/50 transition-all font-medium" data-filter="hardware">
            Hardware
        </button>
      </div>
    </div>

    <div class="max-w-7xl mx-auto px-6">
      
      {(!PRODUCTS || PRODUCTS.length === 0) ? (
        <div class="text-center py-20 border border-dashed border-space-800 rounded-2xl">
          <p class="text-red-400 font-bold text-xl">⚠️ No se encontraron productos cargados.</p>
          <p class="text-text-muted mt-2">
            Revisa el archivo <code>src/data/products.ts</code>.
          </p>
        </div>
      ) : (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="product-grid">
          {PRODUCTS.map((product) => (
            <a 
              href={`/productos/${product.id}`}
              class={`product-card group relative flex flex-col rounded-2xl bg-space-900 border border-space-800 overflow-hidden hover:border-neon-cyan/40 hover:-translate-y-1 transition-all duration-300 shadow-lg hover:shadow-neon-cyan/10 ${product.category}`}
              data-category={product.category}
            >
              {/* Placeholder de Imagen */}
              <div class={`h-48 w-full relative overflow-hidden ${product.imagePlaceholder || 'bg-space-800'} bg-opacity-20`}>
                 <div class={`absolute inset-0 bg-gradient-to-t from-space-900 to-transparent`}></div>
                 <div class="absolute inset-0 flex items-center justify-center">
                    <span class="text-xs font-bold uppercase tracking-widest text-text-muted/50 border border-text-muted/20 px-3 py-1 rounded-full">
                        {product.category}
                    </span>
                 </div>
              </div>

              {/* Contenido */}
              <div class="p-6 flex flex-col flex-1">
                <div class="mb-4">
                    <h3 class="text-xl font-bold text-text-main group-hover:text-neon-cyan transition-colors mb-1">
                        {product.name}
                    </h3>
                    <p class="text-xs text-tech-blue font-bold uppercase tracking-wide">
                        {product.tagline}
                    </p>
                </div>
                
                <p class="text-text-muted text-sm leading-relaxed mb-6 line-clamp-3 flex-1">
                    {product.description}
                </p>

                <div class="mt-auto pt-4 border-t border-space-800 flex items-center justify-between">
                    <span class="font-bold text-text-main">{product.price}</span>
                    <div class="p-2 rounded-full bg-space-950 text-text-muted group-hover:text-neon-cyan group-hover:bg-space-800 transition-all">
                        <ArrowUpRight size={18} />
                    </div>
                </div>
              </div>
            </a>
          ))}
        </div>
      )}
    </div>
    
  </main>

  <Footer />
</BaseLayout>

<script>
  // Script para manejar los filtros de categorías
  document.addEventListener('astro:page-load', () => {
    const buttons = document.querySelectorAll('.filter-btn');
    const cards = document.querySelectorAll('.product-card');

    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        // 1. Resetear estilos de botones
        buttons.forEach(b => {
            b.classList.remove('bg-neon-cyan', 'text-space-950', 'font-bold');
            b.classList.add('bg-space-900', 'text-text-muted', 'font-medium');
        });
        // 2. Activar botón clickeado
        btn.classList.remove('bg-space-900', 'text-text-muted', 'font-medium');
        btn.classList.add('bg-neon-cyan', 'text-space-950', 'font-bold');

        // 3. Filtrar tarjetas
        const filter = btn.getAttribute('data-filter');
        
        cards.forEach((card) => {
           const category = card.getAttribute('data-category');
           // Casting para TypeScript
           const el = card as HTMLElement;
           
           if (filter === 'all' || filter === category) {
             el.style.display = 'flex';
             // Pequeña animación
             el.style.opacity = '0';
             setTimeout(() => el.style.opacity = '1', 50);
           } else {
             el.style.display = 'none';
           }
        });
      });
    });
  });
</script>
