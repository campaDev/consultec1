---
import { Sun, Moon } from 'lucide-react';
---

<button class="theme-toggle-btn relative p-2 rounded-full text-text-muted hover:text-neon-cyan hover:bg-white/5 transition-all focus:outline-none focus:ring-2 focus:ring-neon-cyan/50" aria-label="Cambiar tema">
  <span class="dark-icon block [html[data-theme='light']_&]:hidden">
    <Sun size={20} />
  </span>
  <span class="light-icon hidden [html[data-theme='light']_&]:block">
    <Moon size={20} />
  </span>
</button>

<script>
  const handleToggleClick = () => {
    const element = document.documentElement;
    const currentTheme = element.getAttribute("data-theme");
    const targetTheme = currentTheme === "light" ? "dark" : "light";
    
    element.setAttribute("data-theme", targetTheme);
    localStorage.setItem("theme", targetTheme);
  };

  function initThemeToggle() {
    // CAMBIO 2: Usamos querySelectorAll para encontrar TODOS los botones (Desktop y Mobile)
    // Buscamos por la clase que definimos arriba
    const buttons = document.querySelectorAll(".theme-toggle-btn");

    // Iteramos sobre cada botÃ³n encontrado para asignarle el evento
    buttons.forEach(btn => {
        // Removemos listener previo por seguridad (View Transitions)
        btn.removeEventListener("click", handleToggleClick);
        btn.addEventListener("click", handleToggleClick);
    });
  }

  document.addEventListener('astro:page-load', initThemeToggle);
</script>
